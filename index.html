<!DOCTYPE html>
<html>
<style type="text/css">
    .capslock{
        background: red;
    }
</style>
<script>
    var finalState = null;
    const isMacOs = navigator.platform.startsWith("Mac");

    function update(event, name){
        console.log({e:name, key:event.key, capsLock: event.getModifierState("CapsLock")});

        if(event.key === "CapsLock" && finalState !== null){
            finalState=!finalState;
        } else {
            finalState=event.getModifierState("CapsLock");
        }

        console.log("capslock is ", finalState?"on":"off");

        if(finalState){
            document.getElementById('text').classList=['capslock'];
        }else {
            document.getElementById('text').classList=[];
        }
    }

    document.addEventListener("keyup", event=> {
        document.getElementById('text').append(event.key + " ");
        update(event, "keyup");
    });

    document.addEventListener("keydown", event=> {
        if(isMacOs) update(event, "keydown");
    });

</script>
<body id="text">ver 4:
</body>
</html>